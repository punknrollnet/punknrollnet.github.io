"use strict";function parseUrl(t){var e=document.createElement("a");return e.href=t,e}function parseQuery(t){return t.search.replace("?","").split("&amp;").reduce(function(t,e){var r=e.split("=");return t[r[0]]=r[1],t},{})}var SCALE_HEIGHT=.6,SCALE_PLAYER=.97,RD="https://www.reddit.com";Vue.component("playlist-item",{props:["record"],template:'<div class="row">\n            <div class="column column-10">\n                <img :src="\'https://i.ytimg.com/vi/\' + record.youtube.id + \'/default.jpg\'" alt="Video preview">\n            </div>\n            <div class="column">\n                <h2 class="yt-title">{{ record.youtube.title }}</h2>\n                <p><strong>Score:</strong> {{ record.score }} - <a :href="RD + record.permalink">{{ record.title }}</a><br>\n                  submitted <span class="muted">{{ record.date }}</span> by <a :href="RD + \'/user/\' + record.author">/u/{{ record.author }}</a>.</p>\n            </div>\n        </div>'});var PlayerBase=Vue.extend({el:"#player",mounted:function(){this.bbox=this.$el.getBoundingClientRect(),document.getElementById("video").style.height=this.bbox.width*SCALE_HEIGHT+"px"},methods:{initPlayer:function(){this.youtube=new YT.Player("video",{height:this.bbox.width*SCALE_HEIGHT*SCALE_PLAYER,events:{onStateChange:this.stateChange},playerVars:{autoplay:0,wmode:"transparent"},width:this.bbox.width*SCALE_PLAYER})},loadGenre:function(t){this.$http({url:RD+"/r/"+t+"/search.json",method:"GET",params:{q:"url:youtube.com/watch",sort:this.sort_order,restrict_sr:"on",t:"all"}}).then(this.procResponse)},procResponse:function(t){this.records=new Map;var e=t.body;"string"==typeof e&&(e=JSON.parse(e));var r=!0,i=!1,o=void 0;try{for(var a,n=e.data.children[Symbol.iterator]();!(r=(a=n.next()).done);r=!0){var s=a.value,d=parseQuery(parseUrl(s.data.url));d.v&&(this.video_ids.push(d.v),this.records.set(d.v,s.data))}}catch(l){i=!0,o=l}finally{try{!r&&n["return"]&&n["return"]()}finally{if(i)throw o}}this.youtube.cuePlaylist(this.video_ids)},reload:function(t,e){this.sort_order=t,this.loadGenre(e)},stateChange:function(t){if(t.data==YT.PlayerState.PLAYING){var e=this.youtube.getVideoData();if(document.location.hash=e.video_id,document.title=e.title+" - now playing on punknroll.net",this.records.has(e.video_id)){this.current=this.records.get(e.video_id),this.current.youtube={id:e.video_id,title:e.title};var r=new Date(1e3*this.current.created_utc);this.current.date=r.getFullYear()+"-"+(r.getMonth()+1)+"-"+r.getDate()}}else t.data==YT.PlayerState.ENDED&&(this.current=null)}}});