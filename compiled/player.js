"use strict";function onYouTubeIframeAPIReady(){player.youtube=new YT.Player("video",{height:player.bbox.width*SCALE_HEIGHT,events:{onReady:player.ready,onStateChange:player.stateChange},playerVars:{autoplay:0,playlist:player.video_ids.join(","),wmode:"transparent"},width:player.bbox.width})}function parseUrl(e){var t=document.createElement("a");return t.href=e,t}function parseQuery(e){return e.search.replace("?","").split("&amp;").reduce(function(e,t){var r=t.split("=");return e[r[0]]=r[1],e},{})}var SCALE_HEIGHT=.6,player=new Vue({el:"#player",data:{bbox:null,current:null,records:new Map,video_ids:[],youtube:null},ready:function(){this.bbox=this.$el.getBoundingClientRect(),document.getElementById("video").style.height=this.bbox.width*SCALE_HEIGHT+"px",this.hideRecords(),this.loadPlaylist()},methods:{createIframe:function(){var e=document.createElement("script");e.src="https://www.youtube.com/iframe_api";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)},hideRecords:function(){this.current=null,Array.from(document.getElementsByClassName("record"),function(e){e.style.display="none"})},local:function(e){var t=this;Array.from(e).forEach(function(e){t.video_ids.push(e.id)}),this.createIframe()},loadPlaylist:function(){var e=document.getElementsByClassName("record");e.length?this.local(e):genre&&this.remote(genre)},remote:function(e){var t=this;this.$http({url:"https://www.reddit.com/r/"+e+"/search.json",method:"GET",params:{q:"url:youtube.com/watch",sort:"new",restrict_sr:"on",t:"all"}}).then(function(e){t.records.clear();var r=JSON.parse(e.body).data,a=!0,i=!1,n=void 0;try{for(var o,s=r.children[Symbol.iterator]();!(a=(o=s.next()).done);a=!0){var l=o.value,d=parseQuery(parseUrl(l.data.url));d.v&&(t.video_ids.push(d.v),t.records.set(d.v,l.data))}}catch(u){i=!0,n=u}finally{try{!a&&s["return"]&&s["return"]()}finally{if(i)throw n}}player.createIframe()})},stateChange:function(e){if(e.data==YT.PlayerState.PLAYING){var t=this.youtube.getVideoData();document.title=t.title+" - now playing on punknroll.net",this.hideRecords();var r=document.getElementById(t.video_id);if(r)r.style.display="block";else if(this.records.has(t.video_id)){this.current=this.records.get(t.video_id),this.current.youtube={id:t.video_id,title:t.title};var a=new Date(1e3*this.current.created_utc);this.current.date=a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()}}},stop:function(e){this.hideRecords(),this.youtube.stopVideo()}}});