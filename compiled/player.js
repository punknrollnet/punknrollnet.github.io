"use strict";function onYouTubeIframeAPIReady(){player.youtube=new YT.Player("video",{height:player.bbox.width*SCALE_HEIGHT*SCALE_PLAYER,events:{onReady:player.loadRecords,onStateChange:player.stateChange},playerVars:{autoplay:0,wmode:"transparent"},width:player.bbox.width*SCALE_PLAYER})}function parseUrl(t){var e=document.createElement("a");return e.href=t,e}function parseQuery(t){return t.search.replace("?","").split("&amp;").reduce(function(t,e){var r=e.split("=");return t[r[0]]=r[1],t},{})}var SCALE_HEIGHT=.6,SCALE_PLAYER=.97,player=new Vue({el:"#player",data:{bbox:null,current:null,index:0,records:new Map,sort_order:"new",start_video:null,video_ids:[],youtube:null},ready:function(){document.location.hash&&12==document.location.hash.length&&(this.start_video=document.location.hash.replace("#","")),this.bbox=this.$el.getBoundingClientRect(),document.getElementById("video").style.height=this.bbox.width*SCALE_HEIGHT+"px",this.hideRecords(),this.createIframe()},methods:{createIframe:function(){var t=document.createElement("script");t.src="https://www.youtube.com/iframe_api";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)},genre:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t){this.$http({url:"https://www.reddit.com/r/"+t+"/search.json",method:"GET",params:{q:"url:youtube.com/watch",sort:this.sort_order,restrict_sr:"on",t:"all"}}).then(this.procResponse)}),hideRecords:function(){this.current=null,Array.from(document.getElementsByClassName("record"),function(t){t.style.display="none"})},local:function(t){var e=this;Array.from(t).forEach(function(t){e.video_ids.push(t.id)}),this.loadPlaylist()},loadPlaylist:function(){this.start_video&&this.video_ids.includes(this.start_video)&&(this.index=this.video_ids.indexOf(this.start_video)),this.youtube.cuePlaylist(this.video_ids,this.index)},loadRecords:function(){var t=document.getElementsByClassName("record");t.length?this.local(t):genre?this.genre(genre):document.location.search&&this.search(parseQuery(document.location).q)},procResponse:function(t){this.records.clear();var e=t.body;"string"==typeof e&&(e=JSON.parse(e));var r=!0,o=!1,i=void 0;try{for(var s,n=e.data.children[Symbol.iterator]();!(r=(s=n.next()).done);r=!0){var a=s.value,d=parseQuery(parseUrl(a.data.url));d.v&&(this.video_ids.push(d.v),this.records.set(d.v,a.data))}}catch(l){o=!0,i=l}finally{try{!r&&n["return"]&&n["return"]()}finally{if(o)throw i}}this.loadPlaylist()},reload:function(t){this.sort_order=t,this.start_video=null,this.index=this.video_ids.length,this.loadRecords()},search:function(t){this.$http({url:"https://www.reddit.com/search.json",method:"GET",params:{q:t+" url:youtube.com/watch",sort:this.sort_order,t:"all"}}).then(this.procResponse)},stateChange:function(t){if(t.data==YT.PlayerState.PLAYING){var e=this.youtube.getVideoData();document.location.hash=e.video_id,document.title=e.title+" - now playing on punknroll.net",this.hideRecords();var r=document.getElementById(e.video_id);if(r)r.style.display="block";else if(this.records.has(e.video_id)){this.current=this.records.get(e.video_id),this.current.youtube={id:e.video_id,title:e.title};var o=new Date(1e3*this.current.created_utc);this.current.date=o.getFullYear()+"-"+(o.getMonth()+1)+"-"+o.getDate()}}},stop:function(t){this.hideRecords(),this.youtube.stopVideo()}}});