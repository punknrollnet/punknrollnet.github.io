const SCALE_HEIGHT=.6,SCALE_PLAYER=.97,RD="https://www.reddit.com";function parseUrl(e){var t=document.createElement("a");return t.href=e,t}function parseQuery(e){return e.search.replace("?","").split("&amp;").reduce((t,i)=>{let s=i.split("=");return t[s[0]]=s[1],t},{})}Vue.component("playlist-item",{props:["record"],template:`<div class="row">
            <div class="column column-10">
                <img :src="'https://i.ytimg.com/vi/' + record.youtube.id + '/default.jpg'" alt="Video preview">
            </div>
            <div class="column">
                <h2 class="yt-title">{{ record.youtube.title }}</h2>
                <p><strong>Score:</strong> {{ record.score }} - <a :href="RD + record.permalink">{{ record.title }}</a><br>
                  submitted <span class="muted">{{ record.date }}</span> by <a :href="RD + '/user/' + record.author">/u/{{ record.author }}</a>.</p>
            </div>
        </div>`});let PlayerBase=Vue.extend({el:"#player",mounted:function(){this.bbox=this.$el.getBoundingClientRect(),document.getElementById("video").style.height=`${this.bbox.width*.6}px`},methods:{cuePlaylist:function(){if(this.start_video&&this.video_ids.includes(this.start_video)){let e=this.video_ids.indexOf(this.start_video);this.video_ids=this.video_ids.slice(e)}this.youtube.cuePlaylist(this.video_ids)},initPlayer:function(){this.youtube=new YT.Player("video",{height:this.bbox.width*.6*.97,events:{onReady:this.cuePlaylist,onStateChange:this.stateChange},playerVars:{autoplay:0,wmode:"transparent"},width:this.bbox.width*.97})},loadGenre:function(e){let t=this.sort_order==="hot"?"week":"all";this.$http({url:`${RD}/r/${e}/search.json`,method:"GET",params:{q:"url:youtube.com/watch",sort:this.sort_order,restrict_sr:"on",t}}).then(this.procResponse,i=>console.error(i))},loadPlaylist:function(e){let t=document.getElementsByClassName("record");t.length?(document.getElementById("playlist").style.display="none",Array.from(t).forEach(i=>{this.video_ids.push(i.id)})):this.loadGenre(e)},procResponse:function(e){if(!e.ok)return;this.video_ids=[],this.records=new Map;let t=e.body;typeof t=="string"&&(t=JSON.parse(t));for(let i of t.data.children){let s=parseQuery(parseUrl(i.data.url));s.v&&s.v.length==11&&!this.video_ids.includes(s.v)&&(this.video_ids.push(s.v),this.records.set(s.v,i.data))}this.video_ids&&this.reset&&(this.cuePlaylist(),this.reset=!1)},reload:function(e,t){this.sort_order=e,this.reset=!0,this.start_video=null,this.loadGenre(t)},stateChange:function(e){if(e.data==YT.PlayerState.PLAYING){let t=this.youtube.getVideoData();if(document.location.hash=t.video_id,document.title=`${t.title} - now playing on punknroll.net`,this.records.has(t.video_id)){this.current=this.records.get(t.video_id),this.current.youtube={id:t.video_id,title:t.title};let i=new Date(this.current.created_utc*1e3);this.current.date=`${i.getFullYear()}-${i.getMonth()+1}-${i.getDate()}`}}else e.data==YT.PlayerState.ENDED&&(this.current=null)}}});
