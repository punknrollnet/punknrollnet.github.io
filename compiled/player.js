const SCALE_HEIGHT=0.6,SCALE_PLAYER=0.97;let player=new Vue({el:'#player',data:{bbox:null,current:null,index:0,records:new Map,sort_order:'new',start_video:null,video_ids:[],youtube:null},ready:function(){document.location.hash&&12==document.location.hash.length&&(this.start_video=document.location.hash.replace('#','')),this.bbox=this.$el.getBoundingClientRect(),document.getElementById('video').style.height=`${this.bbox.width*SCALE_HEIGHT}px`,this.hideRecords(),this.createIframe()},methods:{createIframe:()=>{let a=document.createElement('script');a.src='https://www.youtube.com/iframe_api';let b=document.getElementsByTagName('script')[0];b.parentNode.insertBefore(a,b)},genre:function(a){this.$http({url:`https://www.reddit.com/r/${a}/search.json`,method:'GET',params:{q:'url:youtube.com/watch',sort:this.sort_order,restrict_sr:'on',t:'all'}}).then(this.procResponse)},hideRecords:function(){this.current=null,Array.from(document.getElementsByClassName('record'),(a)=>{a.style.display='none'})},local:function(a){Array.from(a).forEach((a)=>{this.video_ids.push(a.id)}),this.loadPlaylist()},loadPlaylist:function(){this.start_video&&this.video_ids.includes(this.start_video)&&(this.index=this.video_ids.indexOf(this.start_video)),this.youtube.cuePlaylist(this.video_ids,this.index)},loadRecords:function(){let a=document.getElementsByClassName('record');a.length?this.local(a):genre?this.genre(genre):document.location.search&&this.search(parseQuery(document.location).q)},procResponse:function(a){this.records.clear();let b=a.body;'string'==typeof b&&(b=JSON.parse(b));for(let c of b.data.children){let a=parseQuery(parseUrl(c.data.url));a.v&&(this.video_ids.push(a.v),this.records.set(a.v,c.data))}this.loadPlaylist()},reload:function(a){this.sort_order=a,this.start_video=null,this.index=this.video_ids.length,this.loadRecords()},search:function(a){this.$http({url:`https://www.reddit.com/search.json`,method:'GET',params:{q:`${a} url:youtube.com/watch`,sort:this.sort_order,t:'all'}}).then(this.procResponse)},stateChange:function(a){if(a.data==YT.PlayerState.PLAYING){let a=this.youtube.getVideoData();document.location.hash=a.video_id,document.title=`${a.title} - now playing on punknroll.net`,this.hideRecords();let b=document.getElementById(a.video_id);if(b)b.style.display='block';else if(this.records.has(a.video_id)){this.current=this.records.get(a.video_id),this.current.youtube={id:a.video_id,title:a.title};let b=new Date(1e3*this.current.created_utc);this.current.date=`${b.getFullYear()}-${b.getMonth()+1}-${b.getDate()}`}}},stop:function(){this.hideRecords(),this.youtube.stopVideo()}}});function onYouTubeIframeAPIReady(){player.youtube=new YT.Player('video',{height:player.bbox.width*SCALE_HEIGHT*SCALE_PLAYER,events:{onReady:player.loadRecords,onStateChange:player.stateChange},playerVars:{autoplay:0,wmode:'transparent'},width:player.bbox.width*SCALE_PLAYER})}function parseUrl(b){var c=document.createElement('a');return c.href=b,c}function parseQuery(a){return a.search.replace('?','').split('&amp;').reduce((a,b)=>{let c=b.split('=');return a[c[0]]=c[1],a},{})}